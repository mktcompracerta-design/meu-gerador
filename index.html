<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Gerador - Gemini</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="mb-3">Gerador de Imagens (Gemini)</h1>

    <div class="card mb-4 p-3">
      <h5>Prompt + Sua Foto</h5>
      <textarea id="prompt" class="form-control mb-2" placeholder="Digite o prompt (opcional)"></textarea>
      <input type="file" id="foto1" accept="image/*" class="form-control mb-2">
      <button id="btnPrompt" class="btn btn-primary">Gerar</button>
      <div id="out1" class="mt-3"></div>
    </div>

    <div class="card mb-4 p-3">
      <h5>Imagem de Referência + Sua Foto</h5>
      <input type="file" id="ref" accept="image/*" class="form-control mb-2">
      <input type="file" id="foto2" accept="image/*" class="form-control mb-2">
      <button id="btnRef" class="btn btn-success">Gerar por Referência</button>
      <div id="out2" class="mt-3"></div>
    </div>

    <div class="card p-3">
      <h6>Observações</h6>
      <ul>
        <li>As imagens são enviadas ao servidor para geração.</li>
        <li>Se der erro, abra /api/list-models e verifique quais modelos sua chave tem acesso.</li>
      </ul>
    </div>
  </div>

<script>
async function postForm(fd) {
  const res = await fetch('/api/gerar', { method: 'POST', body: fd });
  const j = await res.json();
  if (!res.ok) throw new Error(j.error || 'Erro desconhecido');
  return j;
}

document.getElementById('btnPrompt').onclick = async () => {
  const fd = new FormData();
  const p = document.getElementById('prompt').value;
  const f = document.getElementById('foto1').files[0];
  if (f) fd.append('foto', f);
  if (p) fd.append('prompt', p);
  try {
    document.getElementById('out1').innerText = 'Gerando...';
    const j = await postForm(fd);
    document.getElementById('out1').innerHTML = `<img src="data:image/png;base64,${j.image}" class="img-fluid">`;
  } catch (e) {
    document.getElementById('out1').innerText = 'Erro: ' + e.message;
  }
};

document.getElementById('btnRef').onclick = async () => {
  const fd = new FormData();
  const r = document.getElementById('ref').files[0];
  const f = document.getElementById('foto2').files[0];
  if (r) fd.append('referencia', r);
  if (f) fd.append('foto', f);
  try {
    document.getElementById('out2').innerText = 'Gerando...';
    const j = await postForm(fd);
    document.getElementById('out2').innerHTML = `<img src="data:image/png;base64,${j.image}" class="img-fluid">`;
  } catch (e) {
    document.getElementById('out2').innerText = 'Erro: ' + e.message;
  }
};
</script>
</body>
</html>
