<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Gerador de Imagens IA</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body class="bg-light">

<div class="container py-4">

    <h1 class="text-center mb-4">Gerador de Imagens com IA</h1>

    <!-- BLOCO 1 - Prompt + Foto -->
    <div class="card p-4 mb-5 shadow">
        <h3>Gerar com Prompt + Foto</h3>

        <label>Prompt:</label>
        <textarea id="prompt" class="form-control mb-3" rows="2" placeholder="ex: coloque gorro do papai noel"></textarea>

        <label>Foto da Pessoa:</label>
        <input type="file" id="foto1" accept="image/*" class="form-control mb-3">

        <button onclick="gerarPrompt()" class="btn btn-primary w-100">Gerar</button>

        <div class="text-center mt-4">
            <img id="resultado1" class="img-fluid rounded shadow d-none" />
        </div>
    </div>

    <!-- BLOCO 2 - Referência + Foto -->
    <div class="card p-4 shadow">
        <h3>Gerar com Referência + Foto</h3>

        <label>Imagem de Referência:</label>
        <input type="file" id="ref" accept="image/*" class="form-control mb-3">

        <label>Foto da Pessoa:</label>
        <input type="file" id="foto2" accept="image/*" class="form-control mb-3">

        <button onclick="gerarReferencia()" class="btn btn-success w-100">Gerar</button>

        <div class="text-center mt-4">
            <img id="resultado2" class="img-fluid rounded shadow d-none" />
        </div>
    </div>

</div>

<script>
async function enviar(formData) {
    const res = await fetch("/api/gerar", {
        method: "POST",
        body: formData
    });

    const json = await res.json();

    if (json.error) {
        alert(json.error);
        return null;
    }

    return "data:image/png;base64," + json.image;
}

async function gerarPrompt() {
    const fd = new FormData();
    fd.append("prompt", document.getElementById("prompt").value);
    fd.append("foto", document.getElementById("foto1").files[0]);

    const img = await enviar(fd);

    if (img) {
        const el = document.getElementById("resultado1");
        el.src = img;
        el.classList.remove("d-none");
    }
}

async function gerarReferencia() {
    const fd = new FormData();
    fd.append("referencia", document.getElementById("ref").files[0]);
    fd.append("foto", document.getElementById("foto2").files[0]);

    const img = await enviar(fd);

    if (img) {
        const el = document.getElementById("resultado2");
        el.src = img;
        el.classList.remove("d-none");
    }
}
</script>

</body>
</html>
